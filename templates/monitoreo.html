<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="https://tgdolalsmimxcxkuiehl.supabase.co/storage/v1/object/sign/IMG_BIOKUAM/LOGO-BIOKUAM.png?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV81YTA5NWYzYy1hZDYxLTRkN2MtOTlkZC1kYjVkZDAxNTNjYWQiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJJTUdfQklPS1VBTS9MT0dPLUJJT0tVQU0ucG5nIiwiaWF0IjoxNzY4NDQ4ODc5LCJleHAiOjE3NzEwNDA4Nzl9._9t8xngolAI-Tqc0x3qw1eb6lmGXOaMFGIf0ynR-wu8" type="image/x-icon">
    <title>MONITOREO ONLINE | BIOKUAM</title>
    
</head>
<header>
    {% include "header.html" %}
</header>
<body>
   <br>
    <style>
        .seccion-monitoreo {
            padding: 20px 5%;
            background-color: white;
            min-height: 100vh;
        }

        .encabezado-monitoreo {
            text-align: center;
            margin-bottom: 50px;
        }

        .encabezado-monitoreo h1 {
            color: #0D47A1;
            font-size: 2.8rem;
            margin-bottom: 10px;
        }

        .estado-conexion {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: #e8f5e9;
            color: #2e7d32;
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .punto-latente {
            height: 12px;
            width: 12px;
            background-color: #2e7d32;
            border-radius: 50%;
            animation: pulso-verde 2s infinite;
        }

        @keyframes pulso-verde {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(46, 125, 50, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(46, 125, 50, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(46, 125, 50, 0); }
        }

        .contenedor-canales {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .tarjeta-canal {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            border: 1px solid #e0e0e0;
        }

        .titulo-canal {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 15px;
        }

        .titulo-canal i {
            font-size: 1.5rem;
            color: #EF6C00;
        }

        .visualizacion-iot {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid #eee;
            margin-bottom: 20px;
            justify-content: center;    

        }

        /* Contenedor responsivo para iFrames de ThingSpeak */
        .grafico-iot {
            position: relative;
            width: 100%;
            height: 260px;
            margin-bottom: 15px;
            justify-content: center;
        }

        .grafico-iot iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .detalles-tecnicos {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .dato-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }

        .dato-card span {
            display: block;
            font-size: 0.8rem;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .dato-card strong {
            font-size: 1.2rem;
            color: #0D47A1;
        }

        @media (max-width: 600px) {
            .contenedor-canales { grid-template-columns: 1fr; }
            .detalles-tecnicos { grid-template-columns: 1fr; }
        }

        #table-temperatura{
            justify-content: center;
            margin-left: 5.5rem;
            margin-top: 2rem;
        }




        :root {
        --azul-oscuro: #0D47A1;
        --naranja-biokuam: #EF6C00;
        --gris-fondo: #f8f9fa;
        --blanco: #ffffff;
    }

    .seccion-generador-pdf {
        padding: 80px 5%;
        background-color: var(--gris-fondo);
    }

    .contenedor-formulario {
        max-width: 950px;
        margin: 0 auto;
        background: var(--blanco);
        border-radius: 25px;
        box-shadow: 0 20px 50px rgba(13, 71, 161, 0.1);
        overflow: hidden;
        border: 1px solid rgba(13, 71, 161, 0.1);
    }

    .encabezado-formulario {
        background: var(--azul-oscuro);
        color: var(--blanco);
        padding: 40px;
        text-align: center;
    }

    .encabezado-formulario i {
        font-size: 3rem;
        margin-bottom: 15px;
        color: var(--naranja-biokuam);
    }

    .cuerpo-formulario {
        padding: 40px;
    }

    .subtitulo-formulario {
        display: flex;
        align-items: center;
        gap: 10px;
        color: var(--azul-oscuro);
        border-bottom: 2px solid var(--gris-fondo);
        padding-bottom: 10px;
        margin-bottom: 25px;
        margin-top: 20px;
        grid-column: span 2;
    }

    .cuadricula-formulario {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 25px;
    }

    .campo-entrada {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .campo-entrada label {
        font-weight: 600;
        color: #444;
        font-size: 0.9rem;
    }

    .campo-entrada input, 
    .campo-entrada select, 
    .campo-entrada textarea {
        padding: 12px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 1rem;
        transition: all 0.3s ease;
        outline: none;
        font-family: "Cause", cursive;
    }

    .campo-entrada input:focus {
        border-color: var(--azul-oscuro);
        box-shadow: 0 0 0 4px rgba(13, 71, 161, 0.1);
    }

    .ancho-completo {
        grid-column: span 2;
    }

    .boton-generar {
        grid-column: span 2;
        margin-top: 30px;
        text-align: center;
    }

    .btn-pdf {
        background: var(--naranja-biokuam);
        color: white;
        padding: 18px 45px;
        border: none;
        border-radius: 50px;
        font-size: 1.1rem;
        font-weight: bold;
        font-family: "Cause", cursive;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 12px;
        transition: transform 0.3s ease, background 0.3s ease;
        box-shadow: 0 10px 20px rgba(239, 108, 0, 0.3);
    }

    .btn-pdf:hover {
        background: #e65100;
        transform: translateY(-3px);
    }

    /* Responsivo */
    @media (max-width: 768px) {
        .cuadricula-formulario {
            grid-template-columns: 1fr;
        }
        .subtitulo-formulario, .ancho-completo, .boton-generar {
            grid-column: span 1;
        }
    }
    /* Esto oculta el reporte en la pantalla normal */
#area-reporte-imprimir {
    display: none;
}

/* Esto se activa SOLO al presionar el botón de imprimir/PDF */
@media print {
    /* Ocultamos TODO el sitio web (nav, footer, secciones, etc.) */
    body * {
        visibility: hidden;
    }
    /* Mostramos SOLO el área del reporte y sus hijos */
    #area-reporte-imprimir, #area-reporte-imprimir * {
        visibility: visible;
    }
    #area-reporte-imprimir {
        display: block !important;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        padding: 20px;
    }
}
    </style>

    <section class="seccion-monitoreo">
        
        <div class="encabezado-monitoreo">
            <div class="estado-conexion">
                <span class="punto-latente"></span> SISTEMA IOT EN LÍNEA
            </div>
            <h1>CENTRO DE MONITOREO HÍDRICO: ONLINE</h1>
            <p>Visualización de datos en tiempo real para el análisis de calidad de agua en los vallados de Simijaca, Cundinamarca.</p>
        </div>

        <div class="contenedor-canales">
            
            <article class="tarjeta-canal">
                <div class="titulo-canal">
                    <i class="fas fa-thermometer-half"></i>
                    <div>
                        <h2 style="margin:0; font-size: 1.4rem;">CANAL 01: MEDICIÓN TEMPERATURA</h2>
                        <small style="color: #888;">ID Canal: 2755422</small>
                    </div>
                </div>

                <div class="visualizacion-iot">
                    <div class="grafico-iot" id="table-temperatura">
                        <iframe width="250" height="260" style="border: 0px solid #cccccc;" src="https://thingspeak.com/channels/2755422/charts/1?bgcolor=%23ffffff&color=%23d62020&dynamic=true&results=60&type=line&xaxis=TIEMPO&yaxis=TEMPERATURA"></iframe>
                    </div>
                </div>

                <div class="detalles-tecnicos">
                    <div class="dato-card">
                        <span>SENSOR</span>
                        <strong>DS18B20</strong>
                    </div>
                    <div class="dato-card">
                        <span>UNIDAD</span>
                        <strong>GRADOS CELSIUS (°C)</strong>
                    </div>
                </div>
                <p style="font-size: 0.9rem; color: #555; margin-top: 20px;">
                    Monitorea el estrés térmico en el agua, factor crítico para prevenir la proliferación de bacterias que afectan el tallo del Maíz Porva.
                </p>
            </article>

            <article class="tarjeta-canal">
                <div class="titulo-canal">
                    <i class="fas fa-vial"></i>
                    <div>
                        <h2 style="margin:0; font-size: 1.4rem;">CANAL 02: MEDICIÓN POTENCIAL HIDRÓGENO (PH)</h2>
                        <small style="color: #888;">ID Canal: 3151266</small>
                    </div>
                </div>

                <div class="visualizacion-iot">
                    <div class="grafico-iot" id="table-temperatura">
                        <iframe width="450" height="260" src="https://thingspeak.com/channels/3151266/charts/1?bgcolor=%23ffffff&color=%23d62020&dynamic=true&results=60&type=line&xaxis=TIEMPO&yaxis=PH"></iframe>
                    </div>
                </div>

                <div class="detalles-tecnicos">
                    <div class="dato-card">
                        <span>Sensor</span>
                        <strong>PH 4502-C</strong>
                    </div>
                    <div class="dato-card">
                        <span>Rango Ideal</span>
                        <strong>6.5 - 8.5 pH</strong>
                    </div>
                </div>
                <p style="font-size: 0.9rem; color: #555; margin-top: 20px;">
                    Mide la acidez o alcalinidad del agua de riego. Un pH equilibrado es esencial para la correcta absorción de nutrientes en el cultivo.
                </p>
            </article>

        </div>

        <div style="max-width: 1400px; margin: 40px auto 0; background: #0D47A1; color: white; padding: 30px; border-radius: 20px; display: flex; align-items: center; gap: 20px;">
            <i class="fas fa-info-circle fa-2x" style="color: #EF6C00;"></i>
            <p style="margin:0; font-size: 1rem; line-height: 1.5;">
                <strong>NOTA IMPORTANTE:</strong> Los datos se actualizan automáticamente cada 15 segundos gracias al protocolo HTTP/MQTT enviado desde el módulo ESP8266 a los servidores de ThingSpeak. Si no visualiza las gráficas, verifique la conexión a internet de su dispositivo.
            </p>
        </div>

    </section>

    <section class="seccion-generador-pdf">
        <div class="contenedor-formulario">
            <div class="encabezado-formulario">
                <i class="fas fa-file-invoice"></i>
                <h1>GENERADOR DE REPORTE TÉCNICO - BIOKUAM</h1>
                <p>Este apartadp te permite como usuario generar reportes técnicos acerca del estado del cultivo dentro de la Finca, datos dados por los sensores de pH y Temperatura. El reporte es oficial con los datos técnicos.</p>
            </div>

            <form id="form-reporte" class="cuerpo-formulario">
                <div class="cuadricula-formulario">
                    
                    <h3 class="subtitulo-formulario"><i class="fas fa-map-marker-alt"></i> DATOS DE UBICACIÓN Y FECHA</h3>
                    
                    <div class="campo-entrada">
                        <label>NOMBRE DE LA FINCA: </label>
                        <input type="text" id="nombreFinca" placeholder="EJ: EL MIRADOR" required>
                    </div>

                    <div class="campo-entrada">
                        <label>PROPIETARIO DE LA FINCA: </label>
                        <input type="text" id="nombreResponsable" placeholder="NOMBRES Y APELLIDOS" required>
                    </div>

                    <div class="campo-entrada">
                        <label>FOLIO DE LA FINCA (ID): </label>
                        <input type="text" id="folioFinca" placeholder="N° DE IDENTIFICACIÓN" required>
                    </div>

                    <div class="campo-entrada">
                        <label>FECHA DEL REPORTE: </label>
                        <input type="date" id="fechaReporte" required>
                    </div>

                    <h3 class="subtitulo-formulario"><i class="fas fa-robot"></i> INFORMACIÓN DEL PROTOTIPO</h3>

                    <div class="campo-entrada">
                        <label>REFERENCIA DEL PROTOTIPO: </label>
                        <select id="refPrototipo">
                            <option value="BKM-001">BIOKUAM V1.0 (BKM-001)</option>
                            <option value="BKM-002">BIOKUAM V2.0 (BKM-002)</option>
                        </select>
                    </div>

                    <div class="campo-entrada">
                        <label>TEMPERATURA REPORTADA (°C): </label>
                        <input type="number" step="0.1" id="tempReportada" placeholder="0.0">
                    </div>

                    <div class="campo-entrada">
                        <label>PH REPORTADO: </label>
                        <input type="number" step="0.1" id="phReportado" placeholder="7.0">
                    </div>

                    <div class="campo-entrada">
                        <label>HORA DE LA TOMA DE DATOS: </label>
                        <input type="time" id="horaToma">
                    </div>

                    <h3 class="subtitulo-formulario"><i class="fas fa-seedling"></i> ESTADÍSTICAS DEL CULTIVO</h3>

                    <div class="campo-entrada">
                        <label>N° HECTÁREAS DE LA FINCA: </label>
                        <input type="number" step="0.01" id="hectareas" placeholder="CANT. HECTÁREAS">
                    </div>

                    <div class="campo-entrada">
                        <label>PRODUCCIÓN ESTIMADA DE MAÍZ (TONELADAS): </label>
                        <input type="number" step="0.1" id="produccionMaiz" placeholder="TONE. DE MAÍZ">
                    </div>

                    <div class="campo-entrada ancho-completo">
                        <label>OBSERVACIONES ADICIONALES: </label>
                        <textarea id="observaciones" rows="4" placeholder="ESCRIBA EN ESTE APARTADO INFORMACIÓN ADICIONAL ACERCA DEL CLIMA, PLAGAS, ESTADO DEL CULTIVO, ESTADO DE LA FUENTE HÍDRICA, ETC...."></textarea>
                    </div>

                    <div class="boton-generar">
                        <button type="button" class="btn-pdf" id="descargarBtn">
                            <i class="fas fa-file-download"></i> GENERAR Y DESCARGAR PDF
                        </button>
                    </div>

                </div>
            </form>
        </div>
    </section>

    <div style="display: none;">
        <div id="plantilla-pdf" style="width: 700px; padding: 40px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: white; color: #333;">
            
            <div style="border-bottom: 4px solid #0D47A1; padding-bottom: 10px; margin-bottom: 20px; text-align: center;">
                <h1 style="color: #0D47A1; margin: 0; font-size: 28px;">REPORTE TÉCNICO BIOKUAM</h1>
                <p style="color: #EF6C00; font-weight: bold; margin: 5px 0;">Agricultura de Precisión - Simijaca</p>
            </div>

            <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                <tr>
                    <td style="padding: 8px; border: 1px solid #ddd; background: #f9f9f9;"><strong>Finca:</strong></td>
                    <td style="padding: 8px; border: 1px solid #ddd;" id="pdf-finca"></td>
                    <td style="padding: 8px; border: 1px solid #ddd; background: #f9f9f9;"><strong>Fecha:</strong></td>
                    <td style="padding: 8px; border: 1px solid #ddd;" id="pdf-fecha"></td>
                </tr>
                <tr>
                    <td style="padding: 8px; border: 1px solid #ddd; background: #f9f9f9;"><strong>Responsable:</strong></td>
                    <td style="padding: 8px; border: 1px solid #ddd;" id="pdf-responsable"></td>
                    <td style="padding: 8px; border: 1px solid #ddd; background: #f9f9f9;"><strong>Prototipo:</strong></td>
                    <td style="padding: 8px; border: 1px solid #ddd;" id="pdf-proto"></td>
                </tr>
            </table>

            <div style="background: #0D47A1; color: white; padding: 10px; margin-bottom: 15px; border-radius: 5px;">
                <h3 style="margin: 0;">Métricas de Calidad de Agua</h3>
            </div>
            <div style="display: flex; justify-content: space-around; padding: 15px; border: 1px solid #0D47A1; border-radius: 10px; margin-bottom: 20px;">
                <div style="text-align: center;">
                    <span style="display: block; font-size: 12px; color: #666;">Temperatura</span>
                    <strong style="font-size: 20px;" id="pdf-temp">--</strong> °C
                </div>
                <div style="text-align: center;">
                    <span style="display: block; font-size: 12px; color: #666;">pH Agua</span>
                    <strong style="font-size: 20px;" id="pdf-ph">--</strong>
                </div>
                <div style="text-align: center;">
                    <span style="display: block; font-size: 12px; color: #666;">Hora</span>
                    <strong style="font-size: 20px;" id="pdf-hora">--</strong>
                </div>
            </div>

            <h3 style="color: #0D47A1; border-bottom: 2px solid #eee;">Observaciones del Cultivo</h3>
            <p style="font-size: 14px; line-height: 1.6; color: #444;" id="pdf-notas"></p>

            <div style="margin-top: 50px; text-align: center; font-size: 12px; color: #999; border-top: 1px solid #eee; padding-top: 10px;">
                Documento generado automáticamente por el Sistema BioKuaM
            </div>
        </div>
    </div>

    <div id="area-reporte-imprimir">
    <div style="border: 4px solid #0D47A1; padding: 30px; font-family: Arial, sans-serif;">
        <h1 style="color: #0D47A1; text-align: center;">BIOKUAM - REPORTE TÉCNICO</h1>
        <hr>
        <p><strong>Finca:</strong> <span id="p-finca"></span></p>
        <p><strong>Responsable:</strong> <span id="p-responsable"></span></p>
        <p><strong>Fecha:</strong> <span id="p-fecha"></span></p>
        <br>
        <div style="background: #f0f0f0; padding: 20px;">
            <h3>Métricas de Calidad de Agua</h3>
            <p>Temperatura: <span id="p-temp"></span> °C</p>
            <p>pH: <span id="p-ph"></span></p>
        </div>
        <br>
        <p><strong>Observaciones:</strong></p>
        <p id="p-notas"></p>
    </div>
</div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="{{ url_for('static', path='scripts/generador_pdf.js') }}"></script>

   <br>
</body>
<footer>
    {% include "footer.html" %}
</footer>
</html>


